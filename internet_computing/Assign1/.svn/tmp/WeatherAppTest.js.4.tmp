var weatherApp = require('./WeatherApp.js');

exports.testGeneratePathForHttpRequest = function(test){
	test.equal('/forecastrss?w=2499999&u=f', weatherApp.generatePathForHttpRequest(2499999));
	test.done();
}

exports.testGenerateHttpOptionsForHttpRequest = function(test){
	var httpOptions = {
  		host: 'weather.yahooapis.com',
  		port: 80,
  		path: '/forecastrss?w=2499999&u=f'
	};

	var path = weatherApp.generatePathForHttpRequest(2499999);
	test.equal(httpOptions.host, weatherApp.generateHttpOptionsForHttpRequest(path).host);
	test.equal(httpOptions.port, weatherApp.generateHttpOptionsForHttpRequest(path).port);
	test.equal(httpOptions.path, weatherApp.generateHttpOptionsForHttpRequest(path).path);
	test.done();
}

exports.testParseHttpResultOfErrorFromHtmlString = function(test){
	htmlContentString = '<?xml version="1.0" encoding="UTF-8" standalone="yes" ?><rss version="2.0" xmlns:yweather="http://xml.weather.yahoo.com/ns/rss/1.0" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"><channel><title>Yahoo! Weather - Error</title><description>Yahoo! Weather Error</description><item><title>City not found</title><description>Invalid Input /forecastrss?w=0&amp;u=f</description></item></channel></rss><!-- api1.weather.bf1.yahoo.com Tue Jul 16 01:09:02 PST 2013 -->';
	test.equal('Error', weatherApp.getCurrentCityAndStateFromResponseData(htmlContentString));
	test.done();
}

exports.testParseHttpResultOfCityAndStateFromHtmlString = function(test){
	htmlContentString = '<?xml version="1.0" encoding="UTF-8" standalone="yes" ?><rss version="2.0" xmlns:yweather="http://xml.weather.yahoo.com/ns/rss/1.0" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"><channel><title>Yahoo! Weather - Stinson, KY</title><link>http://us.rd.yahoo.com/dailynews/rss/weather/Stinson__KY/*http://weather.yahoo.com/forecast/USKY1005_f.html</link><description>Yahoo! Weather for Stinson, KY</description><language>en-us</language><lastBuildDate>Sat, 13 Jul 2013 8:49 pm EDT</lastBuildDate><ttl>60</ttl><yweather:location city="Stinson" region="KY"   country="United States"/><yweather:units temperature="F" distance="mi" pressure="in" speed="mph"/><yweather:wind chill="79"   direction="70"   speed="5" /><yweather:atmosphere humidity="64"  visibility="10"  pressure="30.12"  rising="1" /><yweather:astronomy sunrise="6:16 am"   sunset="8:53 pm"/><image><title>Yahoo! Weather</title><width>142</width><height>18</height><link>http://weather.yahoo.com</link><url>http://l.yimg.com/a/i/brand/purplelogo//uh/us/news-wea.gif</url></image><item><title>Conditions for Stinson, KY at 8:49 pm EDT</title><geo:lat>38.31</geo:lat><geo:long>-82.88</geo:long><link>http://us.rd.yahoo.com/dailynews/rss/weather/Stinson__KY/*http://weather.yahoo.com/forecast/USKY1005_f.html</link><pubDate>Sat, 13 Jul 2013 8:49 pm EDT</pubDate><yweather:condition  text="Fair"  code="34"  temp="79"  date="Sat, 13 Jul 2013 8:49 pm EDT" /><description><![CDATA[<img src="http://l.yimg.com/a/i/us/we/52/34.gif"/><br /><b>Current Conditions:</b><br />Fair, 79 F<BR /><BR /><b>Forecast:</b><BR />Sat - Partly Cloudy. High: 84 Low: 66<br />Sun - Mostly Sunny. High: 90 Low: 66<br />Mon - Sunny. High: 93 Low: 68<br />Tue - Isolated Thunderstorms. High: 94 Low: 70<br />Wed - Scattered Thunderstorms. High: 91 Low: 69<br /><br /><a href="http://us.rd.yahoo.com/dailynews/rss/weather/Stinson__KY/*http://weather.yahoo.com/forecast/USKY1005_f.html">Full Forecast at Yahoo! Weather</a><BR/><BR/>(provided by <a href="http://www.weather.com" >The Weather Channel</a>)<br/>]]></description><yweather:forecast day="Sat" date="13 Jul 2013" low="66" high="84" text="Partly Cloudy" code="29" /><yweather:forecast day="Sun" date="14 Jul 2013" low="66" high="90" text="Mostly Sunny" code="34" /><yweather:forecast day="Mon" date="15 Jul 2013" low="68" high="93" text="Sunny" code="32" /><yweather:forecast day="Tue" date="16 Jul 2013" low="70" high="94" text="Isolated Thunderstorms" code="37" /><yweather:forecast day="Wed" date="17 Jul 2013" low="69" high="91" text="Scattered Thunderstorms" code="38" /><guid isPermaLink="false">USKY1005_2013_07_17_7_00_EDT</guid></item></channel></rss><!-- api18.weather.gq1.yahoo.com Sun Jul 14 01:31:26 PST 2013 -->';
	test.equal('Stinson, KY', weatherApp.getCurrentCityAndStateFromResponseData(htmlContentString));
	test.done();
}

exports.testParseStateFromCityAndStateString = function(test){
	htmlContentString = '<?xml version="1.0" encoding="UTF-8" standalone="yes" ?><rss version="2.0" xmlns:yweather="http://xml.weather.yahoo.com/ns/rss/1.0" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"><channel><title>Yahoo! Weather - Stinson, KY</title><link>http://us.rd.yahoo.com/dailynews/rss/weather/Stinson__KY/*http://weather.yahoo.com/forecast/USKY1005_f.html</link><description>Yahoo! Weather for Stinson, KY</description><language>en-us</language><lastBuildDate>Sat, 13 Jul 2013 8:49 pm EDT</lastBuildDate><ttl>60</ttl><yweather:location city="Stinson" region="KY"   country="United States"/><yweather:units temperature="F" distance="mi" pressure="in" speed="mph"/><yweather:wind chill="79"   direction="70"   speed="5" /><yweather:atmosphere humidity="64"  visibility="10"  pressure="30.12"  rising="1" /><yweather:astronomy sunrise="6:16 am"   sunset="8:53 pm"/><image><title>Yahoo! Weather</title><width>142</width><height>18</height><link>http://weather.yahoo.com</link><url>http://l.yimg.com/a/i/brand/purplelogo//uh/us/news-wea.gif</url></image><item><title>Conditions for Stinson, KY at 8:49 pm EDT</title><geo:lat>38.31</geo:lat><geo:long>-82.88</geo:long><link>http://us.rd.yahoo.com/dailynews/rss/weather/Stinson__KY/*http://weather.yahoo.com/forecast/USKY1005_f.html</link><pubDate>Sat, 13 Jul 2013 8:49 pm EDT</pubDate><yweather:condition  text="Fair"  code="34"  temp="79"  date="Sat, 13 Jul 2013 8:49 pm EDT" /><description><![CDATA[<img src="http://l.yimg.com/a/i/us/we/52/34.gif"/><br /><b>Current Conditions:</b><br />Fair, 79 F<BR /><BR /><b>Forecast:</b><BR />Sat - Partly Cloudy. High: 84 Low: 66<br />Sun - Mostly Sunny. High: 90 Low: 66<br />Mon - Sunny. High: 93 Low: 68<br />Tue - Isolated Thunderstorms. High: 94 Low: 70<br />Wed - Scattered Thunderstorms. High: 91 Low: 69<br /><br /><a href="http://us.rd.yahoo.com/dailynews/rss/weather/Stinson__KY/*http://weather.yahoo.com/forecast/USKY1005_f.html">Full Forecast at Yahoo! Weather</a><BR/><BR/>(provided by <a href="http://www.weather.com" >The Weather Channel</a>)<br/>]]></description><yweather:forecast day="Sat" date="13 Jul 2013" low="66" high="84" text="Partly Cloudy" code="29" /><yweather:forecast day="Sun" date="14 Jul 2013" low="66" high="90" text="Mostly Sunny" code="34" /><yweather:forecast day="Mon" date="15 Jul 2013" low="68" high="93" text="Sunny" code="32" /><yweather:forecast day="Tue" date="16 Jul 2013" low="70" high="94" text="Isolated Thunderstorms" code="37" /><yweather:forecast day="Wed" date="17 Jul 2013" low="69" high="91" text="Scattered Thunderstorms" code="38" /><guid isPermaLink="false">USKY1005_2013_07_17_7_00_EDT</guid></item></channel></rss><!-- api18.weather.gq1.yahoo.com Sun Jul 14 01:31:26 PST 2013 -->';
	cityAndStateString = weatherApp.getCurrentCityAndStateFromResponseData(htmlContentString);
	test.equal('KY', weatherApp.parseStateFromCityAndStateString(cityAndStateString));
	test.done();
}

exports.testParseCityFromCityAndStateString = function(test){
	htmlContentString = '<?xml version="1.0" encoding="UTF-8" standalone="yes" ?><rss version="2.0" xmlns:yweather="http://xml.weather.yahoo.com/ns/rss/1.0" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"><channel><title>Yahoo! Weather - Stinson, KY</title><link>http://us.rd.yahoo.com/dailynews/rss/weather/Stinson__KY/*http://weather.yahoo.com/forecast/USKY1005_f.html</link><description>Yahoo! Weather for Stinson, KY</description><language>en-us</language><lastBuildDate>Sat, 13 Jul 2013 8:49 pm EDT</lastBuildDate><ttl>60</ttl><yweather:location city="Stinson" region="KY"   country="United States"/><yweather:units temperature="F" distance="mi" pressure="in" speed="mph"/><yweather:wind chill="79"   direction="70"   speed="5" /><yweather:atmosphere humidity="64"  visibility="10"  pressure="30.12"  rising="1" /><yweather:astronomy sunrise="6:16 am"   sunset="8:53 pm"/><image><title>Yahoo! Weather</title><width>142</width><height>18</height><link>http://weather.yahoo.com</link><url>http://l.yimg.com/a/i/brand/purplelogo//uh/us/news-wea.gif</url></image><item><title>Conditions for Stinson, KY at 8:49 pm EDT</title><geo:lat>38.31</geo:lat><geo:long>-82.88</geo:long><link>http://us.rd.yahoo.com/dailynews/rss/weather/Stinson__KY/*http://weather.yahoo.com/forecast/USKY1005_f.html</link><pubDate>Sat, 13 Jul 2013 8:49 pm EDT</pubDate><yweather:condition  text="Fair"  code="34"  temp="79"  date="Sat, 13 Jul 2013 8:49 pm EDT" /><description><![CDATA[<img src="http://l.yimg.com/a/i/us/we/52/34.gif"/><br /><b>Current Conditions:</b><br />Fair, 79 F<BR /><BR /><b>Forecast:</b><BR />Sat - Partly Cloudy. High: 84 Low: 66<br />Sun - Mostly Sunny. High: 90 Low: 66<br />Mon - Sunny. High: 93 Low: 68<br />Tue - Isolated Thunderstorms. High: 94 Low: 70<br />Wed - Scattered Thunderstorms. High: 91 Low: 69<br /><br /><a href="http://us.rd.yahoo.com/dailynews/rss/weather/Stinson__KY/*http://weather.yahoo.com/forecast/USKY1005_f.html">Full Forecast at Yahoo! Weather</a><BR/><BR/>(provided by <a href="http://www.weather.com" >The Weather Channel</a>)<br/>]]></description><yweather:forecast day="Sat" date="13 Jul 2013" low="66" high="84" text="Partly Cloudy" code="29" /><yweather:forecast day="Sun" date="14 Jul 2013" low="66" high="90" text="Mostly Sunny" code="34" /><yweather:forecast day="Mon" date="15 Jul 2013" low="68" high="93" text="Sunny" code="32" /><yweather:forecast day="Tue" date="16 Jul 2013" low="70" high="94" text="Isolated Thunderstorms" code="37" /><yweather:forecast day="Wed" date="17 Jul 2013" low="69" high="91" text="Scattered Thunderstorms" code="38" /><guid isPermaLink="false">USKY1005_2013_07_17_7_00_EDT</guid></item></channel></rss><!-- api18.weather.gq1.yahoo.com Sun Jul 14 01:31:26 PST 2013 -->';
	cityAndStateString = weatherApp.getCurrentCityAndStateFromResponseData(htmlContentString);
	test.equal('Stinson', weatherApp.parseCityFromCityAndStateString(cityAndStateString));
	test.done();
}

exports.testGetCurrentTemperatureFromResponseData = function(test){
	htmlContentString = '<?xml version="1.0" encoding="UTF-8" standalone="yes" ?><rss version="2.0" xmlns:yweather="http://xml.weather.yahoo.com/ns/rss/1.0" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"><channel><title>Yahoo! Weather - Stinson, KY</title><link>http://us.rd.yahoo.com/dailynews/rss/weather/Stinson__KY/*http://weather.yahoo.com/forecast/USKY1005_f.html</link><description>Yahoo! Weather for Stinson, KY</description><language>en-us</language><lastBuildDate>Sat, 13 Jul 2013 8:49 pm EDT</lastBuildDate><ttl>60</ttl><yweather:location city="Stinson" region="KY"   country="United States"/><yweather:units temperature="F" distance="mi" pressure="in" speed="mph"/><yweather:wind chill="79"   direction="70"   speed="5" /><yweather:atmosphere humidity="64"  visibility="10"  pressure="30.12"  rising="1" /><yweather:astronomy sunrise="6:16 am"   sunset="8:53 pm"/><image><title>Yahoo! Weather</title><width>142</width><height>18</height><link>http://weather.yahoo.com</link><url>http://l.yimg.com/a/i/brand/purplelogo//uh/us/news-wea.gif</url></image><item><title>Conditions for Stinson, KY at 8:49 pm EDT</title><geo:lat>38.31</geo:lat><geo:long>-82.88</geo:long><link>http://us.rd.yahoo.com/dailynews/rss/weather/Stinson__KY/*http://weather.yahoo.com/forecast/USKY1005_f.html</link><pubDate>Sat, 13 Jul 2013 8:49 pm EDT</pubDate><yweather:condition  text="Fair"  code="34"  temp="79"  date="Sat, 13 Jul 2013 8:49 pm EDT" /><description><![CDATA[<img src="http://l.yimg.com/a/i/us/we/52/34.gif"/><br /><b>Current Conditions:</b><br />Fair, 79 F<BR /><BR /><b>Forecast:</b><BR />Sat - Partly Cloudy. High: 84 Low: 66<br />Sun - Mostly Sunny. High: 90 Low: 66<br />Mon - Sunny. High: 93 Low: 68<br />Tue - Isolated Thunderstorms. High: 94 Low: 70<br />Wed - Scattered Thunderstorms. High: 91 Low: 69<br /><br /><a href="http://us.rd.yahoo.com/dailynews/rss/weather/Stinson__KY/*http://weather.yahoo.com/forecast/USKY1005_f.html">Full Forecast at Yahoo! Weather</a><BR/><BR/>(provided by <a href="http://www.weather.com" >The Weather Channel</a>)<br/>]]></description><yweather:forecast day="Sat" date="13 Jul 2013" low="66" high="84" text="Partly Cloudy" code="29" /><yweather:forecast day="Sun" date="14 Jul 2013" low="66" high="90" text="Mostly Sunny" code="34" /><yweather:forecast day="Mon" date="15 Jul 2013" low="68" high="93" text="Sunny" code="32" /><yweather:forecast day="Tue" date="16 Jul 2013" low="70" high="94" text="Isolated Thunderstorms" code="37" /><yweather:forecast day="Wed" date="17 Jul 2013" low="69" high="91" text="Scattered Thunderstorms" code="38" /><guid isPermaLink="false">USKY1005_2013_07_17_7_00_EDT</guid></item></channel></rss><!-- api18.weather.gq1.yahoo.com Sun Jul 14 01:31:26 PST 2013 -->';
	test.equal('79', weatherApp.getCurrentTemperatureFromResponseData(htmlContentString));
	test.done();
}	

exports.testGetErrorFromHttpRequest = function(test) {
	var path = weatherApp.generatePathForHttpRequest(0);
	var httpOptions = weatherApp.generateHttpOptionsForHttpRequest(path);
	var handlerFunc = function(error, content){
		test.equal('Error', weatherApp.getCurrentCityAndStateFromResponseData(content));
		test.done();
	}
	weatherApp.getStringHttpRequest(httpOptions, handlerFunc);
}